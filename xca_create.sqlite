DROP TABLE IF EXISTS conferences;
CREATE TABLE conferences
(
    id INTEGER PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    abbreviation VARCHAR(10)
);

DROP TABLE IF EXISTS meet_names;
CREATE TABLE meet_names
(
    id INTEGER PRIMARY KEY,
    name VARCHAR(150) NOT NULL
);

DROP TABLE IF EXISTS runners;
CREATE TABLE runners
(
    id INTEGER PRIMARY KEY,
    surname VARCHAR(100) NOT NULL,
    given_name VARCHAR(100) NOT NULL,
    nicknames VARCHAR(200),
    gender VARCHAR(1) NOT NULL,
    `year` YEAR
);

DROP TABLE IF EXISTS runner_nicknames;
CREATE TABLE runner_nicknames
(
    id INTEGER PRIMARY KEY,
    nickname VARCHAR(100) NOT NULL,
    runner_id INT UNSIGNED NOT NULL,
    FOREIGN KEY (runner_id) REFERENCES runners (id)
);


DROP TABLE IF EXISTS schools;
CREATE TABLE schools
(
    id INTEGER PRIMARY KEY,
    name VARCHAR(150) NOT NULL,
    `type` VARCHAR(100),
    name_first BOOLEAN NOT NULL,
    nicknames VARCHAR(100),
    conference_id INT UNSIGNED,
    FOREIGN KEY (conference_id) REFERENCES conferences (id)
);

DROP TABLE IF EXISTS school_nicknames;
CREATE TABLE school_nicknames
(
    id INTEGER PRIMARY KEY,
    nickname VARCHAR(100) NOT NULL,
    school_id INT UNSIGNED NOT NULL,
    FOREIGN KEY (school_id) REFERENCES schools (id)
);

DROP TABLE IF EXISTS affiliations;
CREATE TABLE affiliations
(
    id INTEGER PRIMARY KEY,
    runner_id INT UNSIGNED NOT NULL,
    school_id INT UNSIGNED NOT NULL,
    `year` YEAR NOT NULL,
    FOREIGN KEY (runner_id) REFERENCES runners (id),
    FOREIGN KEY (school_id) REFERENCES schools (id)
);    

DROP TABLE IF EXISTS races;
CREATE TABLE races
(
    id INTEGER PRIMARY KEY,
    distance INT NOT NULL
);

DROP TABLE IF EXISTS venues;
CREATE TABLE venues
(
    id INTEGER PRIMARY KEY,
    name VARCHAR(150),
    city VARCHAR(100) NOT NULL,
    state VARCHAR(100) NOT NULL,
    elevation INT
);

DROP TABLE IF EXISTS meets;
CREATE TABLE meets
(
    id INTEGER PRIMARY KEY,
    meet_name_id INT UNSIGNED,
    `date` DATE NOT NULL,
    venue_id INT UNSIGNED,
    mens_race_id INT UNSIGNED,
    womens_race_id INT UNSIGNED,
    FOREIGN KEY (meet_name_id) REFERENCES meet_names (id),
    FOREIGN KEY (venue_id) REFERENCES venues (id),
    FOREIGN KEY (mens_race_id) REFERENCES races (id),
    FOREIGN KEY (womens_race_id) REFERENCES races (id)
);

DROP TABLE IF EXISTS results;
CREATE TABLE results
(
    id INTEGER PRIMARY KEY,
    runner_id INT UNSIGNED NOT NULL,
    race_id INT UNSIGNED NOT NULL,
    `time` DOUBLE NOT NULL,
    FOREIGN KEY (runner_id) REFERENCES runners (id),
    FOREIGN KEY (race_id) REFERENCES races (id)
);

DROP VIEW IF EXISTS performances;
CREATE VIEW performances
    AS SELECT results.id, runner_id, race_id, `time`, distance, (`time`/distance*1609) AS pace
    FROM results INNER JOIN runners ON results.runner_id = runners.id
    INNER JOIN races ON results.race_id = races.id ORDER BY runner_id, distance, pace;
